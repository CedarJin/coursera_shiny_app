---
title: "shiny app presentation"
author: "Yanshan Jin"
date: "2024-10-15"
output: slidy_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## The idea

This is a documentation for this shiny app.

This shiny app allows the users to explore the linear relationship using plots generated in the shiny app.

On the sidebar, the users can input the title of their analysis, which would show up on the first row of the main panel.

Follwing the title of the analysis, the users can select if they want to see the data structure and if they want the y variable to be log tranformed.

The users can define the number of observations they want to view on the mian panel as well on the sidebar.

A help text indicates that the users do not need to define the y variable since the y variable is set to miles per gallon as default.

The users can select the x variable that they want to display on the main panel.

On the main panel, they can find the plot showing a fitted linear regression line and all the original data points.

All changes will be valid only when the users click the "update view" botton.


## UI interface layout

- text input: set the title of the analysis
- checkbox input: set the analyzing parameters
- multiple selection: set the x variable
- submit botton: submit each time when they want to make changes

## The code for UI

```{r UI, echo = TRUE, eval=FALSE}
fluidPage(

    # Application title
    titlePanel("Plot of mtcars dataset"),

    # Sidebar with a slider input for number of bins
    sidebarLayout(
        sidebarPanel(
                textInput(inputId = "title","The title of the analysis"),
                checkboxInput("structure", "Show data structure", TRUE),
                checkboxInput("log", "Apply log transformation", TRUE),
                br(), # br() element to introduce extra vertical spacing ----
                numericInput("obs", "Number of observations to view:", 10),
                helpText("Note: y value is set as miles per gallon as default so you don't have to select y values."),
                selectInput(inputId = "x",
                            label = "x values",
                            choices = names(mtcars[,-1])),
                submitButton("Update View", icon("refresh")),
                 ),
    # Show a plot of the generated distribution
         mainPanel(
            h4(textOutput("title", container = span)),
            h3("Documentation"),
            h4(HTML("
    <p>This Shiny app allows users to explore the linear relationship using plots generated in the app.</p>
    <p>On the sidebar, users can input the title of their analysis, which will show up as the first row on the main panel.</p>
    <p>Following the title, users can choose whether they want to view the data structure and if they want to apply a log transformation to the y variable.</p>
    <p>Users can define the number of observations they want to view on the main panel using the input field on the sidebar.</p>
    <p>A help text indicates that users do not need to define the y variable since it is set to miles per gallon (mpg) by default.</p>
    <p>Users can select the x variable they want to display on the main panel.</p>
    <p>On the main panel, they will find a plot showing a fitted linear regression line and all the original data points.</p>
    <p>All changes will take effect only when users click the 'Submit' button to update the view.</p>
    ")),
            verbatimTextOutput("summary"),
            h4("Observations"),
            tableOutput("view"),
            h4("My plot"),
            plotOutput("lmplot")
                  )
        )
)

```

## Main panel layout

The main panel would show the title of the analysis, documentation of the app, data structure, data preview based on the number of observations selected by the users, and finally plot with a linear regression line.

## Server code

```{r server, echo=TRUE, eval=FALSE}
function(input, output, session) {
        
        # Reactive expression to get the data based on log transformation
        data <- reactive({
                if (input$log) {
                        mtcars$mpg <- log10(mtcars$mpg + 1)
                }
                mtcars
        })
        
        # Reactive expression to store the plot
        plot_data <- reactive({
                input$action  # Ensure the plot is updated only when the action button is clicked
                
                x_var <- input$x  # Get the x variable input
                y_var <- "mpg"  # Set y to mpg
                
                # Generate the plot using ggplot2
                ggplot(data = data(), aes_string(x = x_var, y = y_var)) + 
                        geom_point() +
                        geom_smooth(method = "lm", se = FALSE) 
                        
        })
        
        # Render the plot title dynamically
        output$title <- renderText({
                input$title
        })
        
        # Show summary of mtcars if checkbox is TRUE
        output$summary <- renderPrint({
                if (input$structure) {
                        summary(data())
                } else {
                        ""
                }
        })
        
        # Show observations based on the input$obs value
        output$view <- renderTable({
                head(data(), input$obs)
        })
        
        # Render the plot conditionally
               output$lmplot <- renderPlot({
                       plot_data()
               })


}
```

## Thanks!